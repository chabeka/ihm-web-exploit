import { Component, Output, EventEmitter } from '@angular/core';
import { Router } from '@angular/router';
import { EnvironnementsService } from '../services/environnements-service';
import { Environnement } from '../models/environnement.model';
import { EnvUpdateService } from '../services/env-update-service';
import { DocumentsServiceService } from '../services/documents-service.service';

@Component({
  selector: 'app-landing-page',
  templateUrl: './landing-page.component.html',
  styleUrls: ['./landing-page.component.scss']
})
export class LandingPageComponent {
  tabEnvironnement!: Environnement[] ;
  selectedEnv! : string;
  env! : Environnement;

  @Output()
  platetforme : EventEmitter<Environnement> = new EventEmitter();
  
  constructor(
    private router: Router, 
    private envService : EnvironnementsService, 
    private envUpdateService: EnvUpdateService,
    private documentsService: DocumentsServiceService){}
  
  onContinue(): void{
    this.router.navigateByUrl('facesnaps');
  }

  ngOnInit(){
    
    this.envService.getAllEnvironnements().subscribe({
      next : faceSnaps => this.tabEnvironnement = faceSnaps
    });

    this.envService.getSnapByIdWithError("Developpement - GNT").subscribe(val => {
      this.env = val!;
      this.envUpdateService.updateEnvName(this.env);
      this.selectedEnv = this.env.nom;
      console.log(this.env);
    });
  }

  onSelectedChange(value: Event){

    let nomEnv = value + "";
    this.envService.getSnapByIdWithError(nomEnv).subscribe(val => {
      this.env = val!;
      console.log(this.env);
      this.env.dfceTimeout = 180001
      // Mise Ã  jour du nom de l'environnement
      this.envUpdateService.updateEnvName(this.env);
    }); 
  }
}
